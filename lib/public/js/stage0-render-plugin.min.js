/*!
* rete-stage0-render-plugin v0.2.14 
* (c) 2019  
* Released under the ISC license.
*/
!function(t){"use strict";var c,e=Object.prototype,l=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",n=o.asyncIterator||"@@asyncIterator",i=o.toStringTag||"@@toStringTag",s="object"==typeof module,a=t.regeneratorRuntime;if(a)s&&(module.exports=a);else{(a=t.regeneratorRuntime=s?module.exports:{}).wrap=C;var p="suspendedStart",h="suspendedYield",d="executing",f="completed",v={},u={};u[r]=function(){return this};var y=Object.getPrototypeOf,m=y&&y(y(j([])));m&&m!==e&&l.call(m,r)&&(u=m);var g=L.prototype=b.prototype=Object.create(u);x.prototype=g.constructor=L,L.constructor=x,L[i]=x.displayName="GeneratorFunction",a.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,L):(t.__proto__=L,i in t||(t[i]="GeneratorFunction")),t.prototype=Object.create(g),t},a.awrap=function(t){return{__await:t}},k(O.prototype),O.prototype[n]=function(){return this},a.AsyncIterator=O,a.async=function(t,e,o,n){var r=new O(C(t,e,o,n));return a.isGeneratorFunction(e)?r:r.next().then(function(t){return t.done?t.value:r.next()})},k(g),g[i]="Generator",g[r]=function(){return this},g.toString=function(){return"[object Generator]"},a.keys=function(o){var n=[];for(var t in o)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in o)return t.value=e,t.done=!1,t}return t.done=!0,t}},a.values=j,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(N),!t)for(var e in this)"t"===e.charAt(0)&&l.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(o){if(this.done)throw o;var n=this;function t(t,e){return i.type="throw",i.arg=o,n.next=t,e&&(n.method="next",n.arg=c),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],i=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=l.call(r,"catchLoc"),a=l.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var o=this.tryEntries.length-1;0<=o;--o){var n=this.tryEntries[o];if(n.tryLoc<=this.prev&&l.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var i=r?r.completion:{};return i.type=t,i.arg=e,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),N(o),v}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e];if(o.tryLoc===t){var n=o.completion;if("throw"===n.type){var r=n.arg;N(o)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,o){return this.delegate={iterator:j(t),resultName:e,nextLoc:o},"next"===this.method&&(this.arg=c),v}}}function C(t,e,o,n){var i,s,a,c,r=e&&e.prototype instanceof b?e:b,l=Object.create(r.prototype),u=new _(n||[]);return l._invoke=(i=t,s=o,a=u,c=p,function(t,e){if(c===d)throw new Error("Generator is already running");if(c===f){if("throw"===t)throw e;return S()}for(a.method=t,a.arg=e;;){var o=a.delegate;if(o){var n=E(o,a);if(n){if(n===v)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(c===p)throw c=f,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);c=d;var r=w(i,s,a);if("normal"===r.type){if(c=a.done?f:h,r.arg===v)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(c=f,a.method="throw",a.arg=r.arg)}}),l}function w(t,e,o){try{return{type:"normal",arg:t.call(e,o)}}catch(t){return{type:"throw",arg:t}}}function b(){}function x(){}function L(){}function k(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function O(c){var e;this._invoke=function(o,n){function t(){return new Promise(function(t,e){!function e(t,o,n,r){var i=w(c[t],c,o);if("throw"!==i.type){var s=i.arg,a=s.value;return a&&"object"==typeof a&&l.call(a,"__await")?Promise.resolve(a.__await).then(function(t){e("next",t,n,r)},function(t){e("throw",t,n,r)}):Promise.resolve(a).then(function(t){s.value=t,n(s)},r)}r(i.arg)}(o,n,t,e)})}return e=e?e.then(t,t):t()}}function E(t,e){var o=t.iterator[e.method];if(o===c){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=c,E(t,e),"throw"===e.method))return v;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var n=w(o,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,v;var r=n.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=c),e.delegate=null,v):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function j(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,n=function t(){for(;++o<e.length;)if(l.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=c,t.done=!0,t};return n.next=n}}return{next:S}}function S(){return{value:c,done:!0}}}(function(){return this}()||Function("return this")()),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("stage0"),require("stage0/keyed")):"function"==typeof define&&define.amd?define(["stage0","stage0/keyed"],e):t.Stage0RenderPlugin=e(t.stage0,t.stage0)}(this,function(t,n){"use strict";function i(t){var e=this.getView();this.root=e.cloneNode(!0);var o=e.collect(this.root);this.setRefs(o),this.init(t)}function e(t,e){t.prototype=Object.assign({},e.prototype,t.prototype),t.prototype.constructor=t}function o(t,e,o){this.type=e,this.node=o,this.name,this.hint,i.call(this,t)}function r(t){this.control=t,i.call(this,t)}function s(t,e){this.name=null,this.node=e,this.showControl=null,i.call(this,t)}function a(t,e){this.name=null,this.node=e,i.call(this,t)}function h(t){this.renderedInputs=[],this.renderedOutputs=[],this.renderedControls=[],this.visibleInputs=void 0,this.visibleOutputs=void 0,this.visibleControls=void 0,this.name=null,this.selected=null,this.visibleCollapsed=!!t.node.data.collapsed,this.renderedCollapsed=null,i.call(this,t)}t=t&&t.hasOwnProperty("default")?t.default:t,i.prototype={getView:function(){return t(["<div></div>"])},init:function(t){this.root.update=this.rootUpdate.bind(this),this.root.update(t)},setRefs:function(t){this.refs=t},rootUpdate:function(t){}},o.prototype.init=function(t){i.prototype.init.call(this,t.socket),this.node.context.bindSocket(this.root,this.type,t)},o.prototype.getView=function(){return t(["<div></div>"])},o.prototype.rootUpdate=function(t){this.name!==t.name&&(this.root.className="socket "+t.name+" "+this.type),this.name===t.name&&this.hint===t.hint||(this.root.title=t.name+"\\n"+(t.hint?t.hint:"")),this.name=t.name,this.hint=t.hint},e(o,i),r.prototype.init=function(t){var e=void 0;this.control.parent.context?e=this.control.parent.context:this.control.parent.node&&(e=this.control.parent.node.context),e.bindControl(this.root,t),i.prototype.init.call(this,t),this.root.addEventListener("mousedown",function(t){t.stopPropagation()})},r.prototype.getView=function(){return t(['<div class="control"></div>'])},r.prototype.rootUpdate=function(t){if(this.control.key!==t.key){for(;this.root.firstChild;)this.root.removeChild(this.root.firstChild);this.root.appendChild(t.stage0Context.root)}this.control=t},e(r,i),s.prototype.getView=function(){return t(['<div class="input"><span class="input-socket" #socket></span><div class="input-title" #inputTitle>#inputName</div><div class="input-control" #controls></div></div>'])},s.prototype.getSocketComponent=function(t){return new o(t,"input",this.node)},s.prototype.getControlComponent=function(t){return new r(t.control,t.node)},s.prototype.rootUpdate=function(t){var e=t.name,o=t.showControl();if(this.showControl!==o){for(;this.refs.controls.firstChild;)this.refs.controls.removeChild(this.refs.controls.firstChild);if(this.root.contains(this.refs.inputtitle)&&this.root.removeChild(this.refs.inputtitle),o){var n=this.getControlComponent(t);this.refs.controls.appendChild(n.root)}else this.root.appendChild(this.refs.inputtitle),this.name!==e&&(this.name=this.refs.inputName.nodeValue=e)}if(!this.refs.socket.firstChild){var r=this.getSocketComponent(t);this.refs.socket.appendChild(r.root)}},e(s,i),a.prototype.getView=function(){return t(['<div class="output"><div class="output-title" #outputTitle>#outputName</div><div #socket></div></div>'])},a.prototype.getSocketComponent=function(t){return new o(t,"output",this.node)},a.prototype.rootUpdate=function(t){var e=t.name;if(this.name!==e&&(this.name=this.refs.outputName.nodeValue=e),!this.refs.socket.firstChild){var o=this.getSocketComponent(t);this.refs.socket.appendChild(o.root)}},e(a,i),h.prototype.init=function(e){var o=this;i.prototype.init.call(this,e),this.refs.collapse.addEventListener("mousedown",function(t){t.stopPropagation()}),this.refs.collapse.addEventListener("click",function(t){o.refs.collapse.classList.contains("closed")?o.visibleCollapsed=!1:o.visibleCollapsed=!0,o.visibleCollapsed!==o.renderedCollapsed&&(o.rootUpdate(e),e.editor.view.updateConnections({node:e.node}))}),this.refs.collapse.ondblclick=function(t){t.stopPropagation()}},h.prototype.getView=function(){return t(['<div class="node"><div class="collapse" #collapse></div><div class="title">#nodeName</div><div class="outputs" #outputs></div><div class="controls" #controls></div><div class="inputs" #inputs></div></div>'])},h.prototype.getInputComponent=function(t,e){return new s(t,e)},h.prototype.getOutputComponent=function(t,e){return new a(t,e)},h.prototype.getControlComponent=function(t,e){return new r(t,e)},h.prototype.rootUpdate=function(e){var o=this,t=e.editor.selected.contains(e.node);this.name===e.node.name&&this.selected===t||(this.root.classList.remove("selected"),t&&this.root.classList.add("selected")),this.selected=t,this.name=this.refs.nodeName.nodeValue=e.node.label?e.node.label:e.node.name,this.visibleCollapsed!==this.renderedCollapsed&&(this.visibleCollapsed?(this.refs.collapse.classList.add("closed"),this.root.classList.add("collapsed"),this.root.insertBefore(this.refs.inputs,this.refs.collapse)):(this.refs.collapse.classList.remove("closed"),this.root.classList.remove("collapsed"),this.root.appendChild(this.refs.inputs)),this.renderedCollapsed=this.visibleCollapsed),this.visibleInputs=Array.from(e.node.inputs.values()).slice(),n.keyed("key",this.refs.inputs,this.renderedInputs,this.visibleInputs,function(t){return o.getInputComponent(t,e.node).root},function(t,e){t.update(e)}),this.renderedInputs=this.visibleInputs.slice(),this.visibleOutputs=Array.from(e.node.outputs.values()).slice(),n.keyed("key",this.refs.outputs,this.renderedOutputs,this.visibleOutputs,function(t){return o.getOutputComponent(t,e.node).root},function(t,e){t.update(e)}),this.renderedOutputs=this.visibleOutputs.slice(),this.visibleControls=Array.from(e.node.controls.values()).slice(),n.keyed("key",this.refs.controls,this.renderedControls,this.visibleControls,function(t){return o.getControlComponent(t,e.node).root},function(t,e){t.update(e)}),this.renderedControls=this.visibleControls.slice()},e(h,i);var d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t};function l(t,e){var o=e.el,n=e.control,r=e.controlProps;this.component=Object.assign({},n.component,r),this.editor=t,this.el=o,i.call(this,n),this.component.root=this.root}return l.prototype.getView=function(){return t([this.component.template])},l.prototype.init=function(t){this.root.update=this.rootUpdate.bind(this)},l.prototype.rootUpdate=function(t){this.component.methods.update.apply(this.component)},e(l,i),{name:"stage0-render",install:function(p,t){p.on("rendernode",function(t){var e=t.el,o=t.node,n=t.component,r=t.bindSocket,i=t.bindControl;if(!n.render||"stage0"===n.render){var s,a,c,l,u=d({},n.props,{node:o,editor:p,bindSocket:r,bindControl:i});o.context=u,o._stage0=(a=(s={el:e,nodeProps:u,component:n}).el,c=s.nodeProps,l=s.component.component||new h(c),c.node.stage0Context=l,a.appendChild(l.root),l),o.update=function(){o.stage0Context.rootUpdate(u)}}}),p.on("rendercontrol",function(t){var e=t.el,o=t.control;if(!o.render||"stage0"===o.render){var n,r,i,s,a,c=d({},o.props,{getData:o.getData.bind(o),putData:o.putData.bind(o)});o._stage0=(n=p,i=(r={el:e,control:o,controlProps:c}).el,s=r.control,a=new l(n,{el:i,control:s,controlProps:r.controlProps}),s.stage0Context=a,i.appendChild(a.root),a.component.mounted(),a),o.update=function(){o.stage0Context.rootUpdate(c)}}}),p.on("connectioncreated connectionremoved",function(t){var e=t.input.node.context,o=t.output.node.context;t.output.node.stage0Context.rootUpdate(o),t.input.node.stage0Context.rootUpdate(e)}),p.on("nodeselected",function(){for(var t in p.nodes){var e=p.nodes[t],o=e.context;e.stage0Context.rootUpdate(o)}})},NodeComponent:h,InputComponent:s,OutputComponent:a,ControlComponent:r,RootControlComponent:l,SocketComponent:o}});
//# sourceMappingURL=stage0-render-plugin.min.js.map
