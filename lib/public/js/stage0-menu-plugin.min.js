/*!
* rete-stage0-menu-plugin v0.3.7 
* (c) 2019  
* Released under the ISC license.
*/
!function(t){"use strict";var c,e=Object.prototype,u=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag",s="object"==typeof module,a=t.regeneratorRuntime;if(a)s&&(module.exports=a);else{(a=t.regeneratorRuntime=s?module.exports:{}).wrap=w;var l="suspendedStart",d="suspendedYield",f="executing",p="completed",m={},h={};h[n]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(j([])));y&&y!==e&&u.call(y,n)&&(h=y);var g=I.prototype=x.prototype=Object.create(h);k.prototype=g.constructor=I,I.constructor=k,I[o]=k.displayName="GeneratorFunction",a.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===k||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,I):(t.__proto__=I,o in t||(t[o]="GeneratorFunction")),t.prototype=Object.create(g),t},a.awrap=function(t){return{__await:t}},L(S.prototype),S.prototype[i]=function(){return this},a.AsyncIterator=S,a.async=function(t,e,r,i){var n=new S(w(t,e,r,i));return a.isGeneratorFunction(e)?n:n.next().then(function(t){return t.done?t.value:n.next()})},L(g),g[o]="Generator",g[n]=function(){return this},g.toString=function(){return"[object Generator]"},a.keys=function(r){var i=[];for(var t in r)i.push(t);return i.reverse(),function t(){for(;i.length;){var e=i.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},a.values=j,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var i=this;function t(t,e){return o.type="throw",o.arg=r,i.next=t,e&&(i.method="next",i.arg=c),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e],o=n.completion;if("root"===n.tryLoc)return t("end");if(n.tryLoc<=this.prev){var s=u.call(n,"catchLoc"),a=u.call(n,"finallyLoc");if(s&&a){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else if(s){if(this.prev<n.catchLoc)return t(n.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return t(n.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&u.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=t,o.arg=e,n?(this.method="next",this.next=n.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;C(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=c),m}}}function w(t,e,r,i){var o,s,a,c,n=e&&e.prototype instanceof x?e:x,u=Object.create(n.prototype),h=new O(i||[]);return u._invoke=(o=t,s=r,a=h,c=l,function(t,e){if(c===f)throw new Error("Generator is already running");if(c===p){if("throw"===t)throw e;return P()}for(a.method=t,a.arg=e;;){var r=a.delegate;if(r){var i=T(r,a);if(i){if(i===m)continue;return i}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(c===l)throw c=p,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);c=f;var n=b(o,s,a);if("normal"===n.type){if(c=a.done?p:d,n.arg===m)continue;return{value:n.arg,done:a.done}}"throw"===n.type&&(c=p,a.method="throw",a.arg=n.arg)}}),u}function b(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function x(){}function k(){}function I(){}function L(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function S(c){var e;this._invoke=function(r,i){function t(){return new Promise(function(t,e){!function e(t,r,i,n){var o=b(c[t],c,r);if("throw"!==o.type){var s=o.arg,a=s.value;return a&&"object"==typeof a&&u.call(a,"__await")?Promise.resolve(a.__await).then(function(t){e("next",t,i,n)},function(t){e("throw",t,i,n)}):Promise.resolve(a).then(function(t){s.value=t,i(s)},n)}n(o.arg)}(r,i,t,e)})}return e=e?e.then(t,t):t()}}function T(t,e){var r=t.iterator[e.method];if(r===c){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=c,T(t,e),"throw"===e.method))return m;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=b(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;var n=i.arg;return n?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=c),e.delegate=null,m):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function j(e){if(e){var t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(u.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=c,t.done=!0,t};return i.next=i}}return{next:P}}function P(){return{value:c,done:!0}}}(function(){return this}()||Function("return this")()),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("stage0"),require("stage0/keyed")):"function"==typeof define&&define.amd?define(["stage0","stage0/keyed"],e):t.Stage0MenuPlugin=e(t.stage0,t.stage0)}(this,function(t,s){"use strict";function n(t){var e=this.getView();this.root=e.cloneNode(!0);var r=e.collect(this.root);this.setRefs(r),this.init(t)}function e(t,e){t.prototype=Object.assign({},e.prototype,t.prototype),t.prototype.constructor=t}function o(t){var e=t.searchBar,r=t.delay,i=t.docked;this.items=[],this.visibleItems=[],this.renderedItems=[],this.visible=!1,this.x=0,this.y=0,this.args={},this.delay=r||100,this.leafs=[],this.docked=i,this.showSearchBar=void 0===e||e,this.searchBar=this.showSearchBar?new a(this):null,this.hideTimeout=null,n.call(this,{})}function i(t,e,r){this.showSubItems=!1,this.visibleSubItems=[],this.renderedSubItems=[],this.hideTimeout=null,this.delay=e,this.menuArgs=r,this.title,n.call(this,t)}function a(t){n.call(this,t)}t=t&&t.hasOwnProperty("default")?t.default:t,n.prototype={getView:function(){return t(["<div></div>"])},init:function(t){this.root.update=this.rootUpdate.bind(this),this.root.update(t)},setRefs:function(t){this.refs=t},rootUpdate:function(t){}},o.prototype.init=function(t){n.prototype.init.call(this,t),this.showSearchBar&&this.root.insertBefore(this.searchBar.root,this.refs.items),this.docked&&this.root.classList.add("docked")},o.prototype.getView=function(){return t(["<div class='context-menu'><div #items></div></div>"])},o.prototype.getItemComponent=function(t,e,r){return new i(t,e,r)},o.prototype.show=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.hideTimeout?(clearTimeout(this.hideTimeout),this.hideTimeout=null):(this.showSearchBar&&(this.searchBar.refs.search.value=""),this.visible=!0,this.x=t,this.y=e,this.args=r,this.rootUpdate())},o.prototype.hide=function(){var t=this;this.visible&&!this.hideTimeout&&(this.hideTimeout=setTimeout(function(){t.visible=!1,t.rootUpdate(),t.hideTimeout=null},this.delay))},o.prototype.updateStyle=function(){this.root.style.top=this.y+"px",this.root.style.left=this.x+"px"},o.prototype.rootUpdate=function(){var e=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";this.visibleItems=this.docked||this.visible?this.items.slice():[],""!=r&&(this.visibleItems=this.docked?[{title:"Search",visible:!0,subitems:this.leafs.filter(function(t){return-1<t.title.toLowerCase().indexOf(r.toLowerCase())})}]:this.leafs.filter(function(t){return-1<t.title.toLowerCase().indexOf(r.toLowerCase())})),this.docked||this.visible&&this.visibleItems.length?this.root.style.display="block":this.root.style.display="none",s.keyed("title",this.refs.items,this.renderedItems,this.visibleItems,function(t){return e.getItemComponent(t,e.delay,e.args).root},function(t,e){return t.update(e)}),this.renderedItems=this.visibleItems.slice(),this.docked||this.updateStyle()},o.prototype.initItemsTrav=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];if(t.data){var i=r.pop();this.addItem({title:i,onClick:function(){e(t)},path:r})}else if("function"==typeof t){var n=r.pop();this.addItem({title:n,onClick:function(){t()},path:r})}else for(var o in t){var s=r.slice();s.push(o),this.initItemsTrav(t[o],e,s)}},o.prototype.initItems=function(t,e){this.initItemsTrav(t,e),this.rootUpdate()},o.prototype.addItem=function(t){var e=t.title,r=t.onClick,i=t.path,n=void 0===i?[]:i,o=this.items,s=function(t){var e=n[t],r=o.find(function(t){return t.title===e});r||(r={title:e,subitems:[]},o.push(r)),o=r.subitems};for(var a in n)s(a);this.leafs.push({title:e,onClick:r,path:n}),o.push({title:e,onClick:r}),this.rootUpdate()},e(o,n),i.prototype.init=function(t){var e=this;n.prototype.init.call(this,t),t.onClick&&(this.root.onclick=function(){t.onClick(e.menuArgs)}),this.root.onmouseover=function(){e.hideTimeout?(clearTimeout(e.hideTimeout),e.hideTimeout=null):(e.showSubItems=!0,e.rootUpdate(t))},this.root.onmouseleave=function(){e.showSubItems&&!e.hideTimeout&&(e.hideTimeout=setTimeout(function(){e.showSubItems=!1,e.rootUpdate(t),e.hideTimeout=null},e.delay))}},i.prototype.getItemComponent=function(t){return new i(t)},i.prototype.getView=function(){return t(["<div class='item'><span #title></span><div class='subitems' #subitems></div></div>"])},i.prototype.rootUpdate=function(t){var e=this,r=t.title,i=t.subitems,n=t.path,o=t.visible;n&&(r=n.join(" <i class='item-path-conn'></i> ")+" <i class='item-path-conn'></i> "+r),this.title!==r&&(this.refs.title.innerHTML=r),this.title=r,i&&i.length?this.root.classList.add("hasSubitems"):this.root.classList.remove("hasSubitems"),this.visibleSubItems=(this.showSubItems||o)&&i||[],s.keyed("title",this.refs.subitems,this.renderedSubItems,this.visibleSubItems,function(t){return e.getItemComponent(t).root},function(t,e){return t.update(e)}),this.renderedSubItems=this.visibleSubItems.slice()},e(i,n),a.prototype.init=function(e){var r=this;n.prototype.init.call(this,e),this.refs.search.onkeyup=function(t){e.rootUpdate(t.target.value)},this.refs.search.onmousedown=function(t){t.stopPropagation()},this.refs.clear.onmousedown=function(t){t.stopPropagation()},this.refs.clear.onclick=function(t){r.refs.search.value="",e.rootUpdate("")}},a.prototype.getView=function(){return t(["<div class='search'><input #search/><span class='clear' #clear></span></div>"])},a.prototype.rootUpdate=function(){},e(a,n);var r,u=function(t){return function(){var a=t.apply(this,arguments);return new Promise(function(o,s){return function e(t,r){try{var i=a[t](r),n=i.value}catch(t){return void s(t)}if(!i.done)return Promise.resolve(n).then(function(t){e("next",t)},function(t){e("throw",t)});o(n)}("next")})}},h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},d=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},f=(r=u(regeneratorRuntime.mark(function t(e,r){var i,n=r.data,o=void 0===n?{}:n,s=r.meta,a=void 0===s?{}:s,c=r.x,u=r.y,h=r.docked,l=void 0!==h&&h,d=r.editor;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createNode(o);case 2:return(i=t.sent).meta=a,i.position[1]=l?(i.position[0]=-d.view.area.transform.x,-d.view.area.transform.y):(i.position[0]=c,u),t.abrupt("return",i);case 6:case"end":return t.stop()}},t,this)})),function(t,e){return r.apply(this,arguments)});function c(t,e){var r=document.createElement("div");t.view.container.appendChild(r);var i=new o(e);return r.appendChild(i.root),i}function p(i,t){var e,r=this,n=t.items,o=t.mouse,s=t.docked,a=t.editor,c=t.allocate;n&&i.initItems(n,(e=u(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=a,t.next=3,f(e,h({},o,{docked:s,editor:a}));case 3:t.t1=t.sent,t.t0.addNode.call(t.t0,t.t1);case 5:case"end":return t.stop()}},t,r)})),function(t){return e.apply(this,arguments)})),a.on("componentregister",function(e){var t,r=e.path?e.path:c(e);r&&i.addItem({title:e.label,onClick:(t=u(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=a,t.next=3,f(e,h({},o,{docked:s,editor:a}));case 3:t.t1=t.sent,t.t0.addNode.call(t.t0,t.t1);case 5:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)}),path:r})})}return{install:function(h,t){var e=t.menuOptions,r=t.dockedMenuOptions,i=void 0===r?null:r;h.bind("hidecontextmenu");var n,o={x:0,y:0},s=c(h,{searchBar:e.searchBar,delay:e.delay,docked:!1}),a=i?c(h,{searchBar:i.searchBar,delay:i.delay,docked:!0}):null,l=c(h,{searchBar:!1,delay:e.delay,docked:!1});h.on("hidecontextmenu",function(){l.hide(),s.hide()}),l.addItem({title:"Delete",onClick:function(t){h.removeNode(t.node),l.hide()}}),l.addItem({title:"Clone",onClick:(n=u(regeneratorRuntime.mark(function t(e){var r,i,n,o,s,a,c,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.node,i=r.name,n=r.data,o=r.meta,s=d(r.position,2),a=s[0],c=s[1],u=h.components.get(i),t.t0=h,t.next=5,f(u,{data:n,meta:o,x:a+10,y:c+10,editor:h,docked:!1});case 5:t.t1=t.sent,t.t0.addNode.call(t.t0,t.t1),l.hide();case 8:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})}),p(s,{items:e.items,mouse:o,docked:!1,editor:h,allocate:e.allocate}),a&&p(a,{items:i.items,mouse:o,docked:!0,editor:h,allocate:i.allocate}),h.on("mousemove",function(t){var e=t.x,r=t.y;o.x=e,o.y=r}),h.on("click",function(){h.trigger("hidecontextmenu")}),h.on("contextmenu",function(t){var e=t.e,r=t.node;e.preventDefault(),e.stopPropagation(),h.trigger("hidecontextmenu");var i=[e.clientX,e.clientY],n=i[0],o=i[1];r?l.show(n,o,{node:r}):s.show(n,o)})}}});
//# sourceMappingURL=stage0-menu-plugin.min.js.map
